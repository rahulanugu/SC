/**
 *
 * ngAudit - A simple utility tool to track your ng app's performance
 *
 */


/**
 *
 * Watcher Tracker
 *
 */

const watcherCount = () => {
  // Passing the root of the document as a start point
  const el = angular.element(document.documentElement);

  return getWatchers(el).length;
}

const getWatchers = (el) => {

  // Get watchers from the scope
  const scope = fetchWatchers(el.data().$scope) || [];

  // Get any watchers any isolate scopes
  const isolateScope = fetchWatchers(el.data().$isolateScope) || [];

  let watchers = [...scope, ...isolateScope];

  // Recursively find watchers attached to child elements
  angular.forEach(el.children(), child => {
    const childrenWatchers = getWatchers(angular.element(child));
    watchers = [...watchers, ...childrenWatchers];
  });

  return watchers;
}

const fetchWatchers = (scope) => {
 // Get the watchers attached or return an empty array
 return scope ? scope.$$watchers : [];
}